var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var minLightbox=function(){function a(){_classCallCheck(this,a),this.startX=null,this.startY=null,this.currentGallery=null,this.currentIndex=null,this.box=null,this.wrapper=null,this.init()}return _createClass(a,[{key:"init",value:function b(){this.images=document.querySelectorAll("a[data-gallery]"),this.galleries=this.sortImages();for(var a=0;a<this.images.length;a++)this.images[a].addEventListener("click",this.openBox.bind(this),!1)}},{key:"sortImages",value:function d(){for(var a,b={},c=0;c<this.images.length;c++)a=this.images[c].dataset.gallery,a in b||(b[a]=[]),b[a].push(this.images[c]);return b}},{key:"openBox",value:function c(a){a.preventDefault();var b=a.target.closest("a[data-gallery]");this.currentGallery=b.getAttribute("data-gallery"),this.currentIndex=this.findImageIndex(b),this.constructBox()}},{key:"constructBox",value:function d(){var a=document.createElement("div");a.classList.add("minBox"),document.querySelector("body").append(a);for(var b="\n\t\t<div class=\"minBoxSlider\">\n\t\t\t<div class=\"slides\">\n\t\t\t",c=0;c<this.galleries[this.currentGallery].length;c++)b+=c===this.currentIndex?"<img src=\""+this.galleries[this.currentGallery][c]+"\" class=\"current\"/>":"<img src=\""+this.galleries[this.currentGallery][c]+"\"/>";b+="\n\t\t\t</div>\n\t\t\t<span class=\"button prev\"></span>\n\t\t\t<span class=\"button next\"></span>\n\t\t</div>\n\t\t",a.innerHTML=b,this.wrapper=document.querySelector(".minBox"),this.slidesContainer=this.wrapper.querySelector(".slides"),this.boxImages=this.wrapper.querySelectorAll(".slides img"),this.attachListeners(),this.wrapper.focus()}},{key:"attachListeners",value:function a(){this.wrapper.addEventListener("click",this.closeBox.bind(this)),this.wrapper.querySelector(".button.prev").addEventListener("click",this.prev.bind(this)),this.wrapper.querySelector(".button.next").addEventListener("click",this.next.bind(this)),this.k=this.doKeyboard.bind(this),document.addEventListener("keydown",this.k),this.slidesContainer.addEventListener("touchstart",this.doTouchStart.bind(this)),this.slidesContainer.addEventListener("touchmove",this.doTouchMove.bind(this))}},{key:"closeBox",value:function c(a){var b=this;(a.target.classList.contains("slides")||a.target.classList.contains("minBoxSlider"))&&(this.wrapper.classList.add("closing"),setTimeout(function(){return b.removeBox()},300))}},{key:"removeBox",value:function a(){this.wrapper.remove(),this.currentGallery=null,this.currentIndex=null,this.box=null,this.wrapper=null,this.boxImages=null,this.slidesContainer=null,document.removeEventListener("keydown",this.k)}},{key:"findImageIndex",value:function c(a){for(var b=0;b<this.galleries[this.currentGallery].length;b++)if(this.galleries[this.currentGallery][b].attributes.href.value===a.attributes.href.value)return b}},{key:"doKeyboard",value:function b(a){"ArrowRight"===a.key?this.next():"ArrowLeft"===a.key&&this.prev()}},{key:"doTouchStart",value:function b(a){this.xDown=a.touches[0].clientX,this.yDown=a.touches[0].clientY}},{key:"doTouchMove",value:function g(a){var b=Math.abs;if(this.xDown&&this.yDown){var c=a.touches[0].clientX,d=a.touches[0].clientY,e=this.xDown-c,f=this.yDown-d;b(e)>b(f)&&(0<e?this.next():this.prev()),this.xDown=null,this.yDown=null}}},{key:"changeSlide",value:function b(a){this.boxImages[this.currentIndex].classList.add("current"),this.boxImages[a].classList.remove("current")}},{key:"next",value:function a(){this.currentIndex===this.boxImages.length-1||(this.currentIndex++,this.changeSlide(this.currentIndex-1))}},{key:"prev",value:function a(){0===this.currentIndex||(this.currentIndex--,this.changeSlide(this.currentIndex+1))}}]),a}();document.addEventListener("DOMContentLoaded",function(){new minLightbox});